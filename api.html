<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ExplodingEmail API</title>
    <style>
        h1, h2, h3, h4, h5, h6 {
            margin-bottom: 3vh;
        }
        
        ol {
            list-style-type: circle;
        }
    </style>
</head>
<body>
<h1>ExplodingEmail API</h1>
<a href="/">Back to home</a>
<p>Table of contents</p>
<ul>
    <li><a href="#introduction">Introduction</a></li>
    <li>
        <a href="#gateway">Gateway</a>
        <ol>
            <li><a href="#gateway-generate">Generate new email/token pair</a></li>
            <li><a href="#gateway-resume">Resume an email from a stored token</a></li>
        </ol>
    </li>
    
    <li>
        <a href="#opcodes">OpCodes</a>
        <ol>
            <li><a href="#opcodes-invalid-token">Invalid token</a></li>
            <li><a href="#opcodes-generation-failure">Generation failure</a></li>
            <li><a href="#opcodes-here-is-your-email-and-token">Here is your email and token</a></li>
            <li><a href="#opcodes-statistics-request-response">Statistics request response</a></li>
            <li><a href="#opcodes-invalid-uri">Invalid URI</a></li>
            <li><a href="#opcodes-resume-success">Resume success</a></li>
            <li><a href="#opcodes-email-incoming">Email incoming</a></li>
            <li><a href="#opcodes-delete-success">Delete success</a></li>
            <li><a href="#opcodes-delete-failure">Delete failure</a></li>
            <li><a href="#opcodes-invalid-json">Invalid JSON</a></li>
            <li><a href="#opcodes-delete-inbox">Delete inbox</a></li>
            <li><a href="#opcodes-invalid-opcode">Invalid opcode</a></li>
            <li><a href="#opcodes-version">Version identifier</a></li>
        </ol>
    </li>
    <li>
        <a href="#examples">Examples</a>
    </li>
</ul>
<hr>
<h2 id="introduction">Introduction</h2>
<p>
    ExplodingEmail is a service that allows you to generate disposable email addresses.
    It is free to use, and is available to everyone.
</p>
<h3>Authentication</h3>
<p>
    Currently, there is no API key or authentication required.  You need only a WebSocket client.<br>
    For NodeJS, we recommend using the <a href="https://npmjs.com/package/ws">ws package</a>.
</p>
<h3>Bugs</h3>
<p>
    Find bugs?  Report them to <a href="mailto:bugreport@exploding.email">bugreport@exploding.email</a><br>
    I'll try to answer your email as soon as possible (note, you will receive a response from dispatch@exploding.email).
</p>
<h2 id="gateway">Gateway</h2>
<p>
    The gateway is how you interact with the API.  The gateway uses <a href="https://json.org">JSON</a> data to communicate with the API.
</p>
<h3 id="gateway-generate">Generate new email/token pair</h3>
<p>
    In order to generate a new email/token on your program, connect to <code>wss://gateway.exploding.email/generate</code><br>
    You should instantly receive a response similar to the one below:
</p>
<pre>
    {
        "email": "adsuoj055904@magicaljellyfish.com",
        "token": "ZLvEW1xaJH6ZsN4zxLDsEp_R5flqmpD5h3LjhucIKIyQv3GDbPunESrNP9veB-nFn9mCT0XxxgTWZlRq63vZSw",
        "op": 2
    }
</pre>
<p>
    The <code>email</code> field is your temporary email address.<br>
    The <code>token</code> field is the resume token.  In case of a disconnect, use this token as described
    in the next section to resume your email.<br>
    If you instead receive the following:
</p>
<pre>
    {
        "error": "Failed to generate new email.",
        "terminated": true,
        "op": 1
    }
</pre>
<p>
    You should instantly close and retry email creation.  If it persists, your IP address may have been banned from the server.
</p>
<h3 id="gateway-resume">Resume email address by token</h3>
<p>
    Disconnects happen on the internet, and there's no way around that.<br>
    You can use your stored token from the generated email address to resume.  Note: an inbox will be deleted after three days (259200 seconds).<br>
    At that point, the email address will be gone (basically) forever.<br>
    To resume, connect to <code>wss://gateway.exploding.email/auth/[YOUR_STORED_TOKEN_HERE]</code><br>
    Example response:
</p>
<pre>
    {
        "email": "adsuoj055904@magicaljellyfish.com",
        "op": 5
    }
</pre>
<p>
    <b>Warning</b>: while you <i>can</i> have multiple clients connected to the websocket under the same token,
    only the one which connected last will receive emails.<br><br>
    If your token was invalid, you will receive the following data:
</p>
<pre>
    {
        "error": "Invalid token",
        "terminated": true,
        "op": 0
    }
</pre>
<p>
    At this point, you should generate a new email address.  The server may close an email before three days (due
    to restarts, maintenance, etc.) email addresses are only stored in-memory.
</p>
<h2 id="opcodes">OpCodes</h2>
<p>
    OpCodes are an easy way for your client to tell what the server is trying to send you, without having to parse the data or message.
</p>
<h4>Data is server -> client unless otherwise specified</h4>
<h3 id="opcodes-invalid-token">0: Invalid token</h3>
<p>
    This is sent whenever a resume token is invalid.  You should generate a new email at this point.
    Example:
</p>
<pre>
    {
        "error": "Invalid token",
        "terminated": true,
        "op": 0
    }
</pre>
<h3 id="opcodes-generation-failure">1: Generation Failure</h3>
<p>
    If the server encounters an internal error, or your IP address is banned from the server,
    the following data will be sent:
</p>
<pre>
    {
        "error": "Failed to generate new email.",
        "terminated": true,
        "op": 1
    }
</pre>
<p>You should try reconnecting three times, then stop if you get the same error.</p>
<h3 id="opcodes-here-is-your-email-and-token">2: Here is your Email and Token</h3>
<p>Yes, this is the name of the OpCode.</p>
<p>This is sent whenever your email and token have been generated successfully from connecting to the <code>/generate</code> path on the gateway.</p>
<p>Example of received data below:</p>
<pre>
    {
        "email": "adsuoj055904@magicaljellyfish.com",
        "token": "ZLvEW1xaJH6ZsN4zxLDsEp_R5flqmpD5h3LjhucIKIyQv3GDbPunESrNP9veB-nFn9mCT0XxxgTWZlRq63vZSw",
        "op": 2
    }
</pre>
<p>Clients should store this token in case of a disconnect.</p>
<h3 id="opcodes-statistics-request-response">3: Statistics Response</h3>
<p>
    This acts as a heartbeat as well as an update for statistics.<br>
    Your client should receive one every second, if it doesn't receive one in a timely manner, disconnect and re-connect with the token.<br>
    Example:
</p>
<pre>
    {
        "op":3,
        "statistics": {
            "emails_received": 3,
            "clients": 4
        }
    }
</pre>
<h3 id="opcodes-invalid-uri">4: Invalid URI</h3>
<p>This is sent only if the URL you requested is invalid, or if there was none specified.</p>
<p>Regardless of its source, you should treat this as an error in your client.</p>
<p>Example:</p>
<pre>
    {
        "error": "Invalid URL",
        "terminated": true,
        "op": 4
    }
</pre>
<h3 id="opcodes-resume-success">5: Resume Success</h3>
<p>Sent to the client on a resume success to the <code>/auth/[token]</code> endpoint.</p>
<p>Example:</p>
<pre>
    {
        "email": "adsuoj055904@magicaljellyfish.com",
        "op": 5
    }
</pre>
<h3 id="opcodes-email-incoming">6: Email Incoming</h3>
<p>Sent to the client whenever there is an email.</p>
<p>This may contain a large amount of data depending on the size of the email, so make sure to keep that in mind if you encounter errors with this op.</p>
<p><b>If you have multiple clients connected to the same email, only the most recently connected one will receive this.</b></p>
<p>Example:</p>
<pre>
    {
        "type": "email",
        "data": {
            "from": "someone@example.com",
            "to": "adsuoj055904@magicaljellyfish.com",
            "subject": "Hello",
            "body": "body of the email",
            "date": 1650314854488,
            "ip": "127.0.0.1"
        },
        "op": 6
    }
</pre>
<p>Where:</p>
<ul>
    <li><b>from</b> is who sent the email (note: there is no validation on our end)</li>
    <li><b>to</b> is your email address</li>
    <li><b>subject</b> is the email subject</li>
    <li><b>body</b> is the body of the email (may be html)</li>
    <li><b>date</b> is the unix timestamp of when the email was sent in milliseconds</li>
    <li><b>ip</b> is the IP address of the sender (can be used for validation)</li>
</ul>
<h3 id="opcodes-delete-success">7: Delete Success</h3>
<p>Received in response to <a href="#opcodes-delete-inbox">10 Delete Inbox</a> that the client sends.</p>
<pre>
    {
        "message": "Deleted.  Please re-connect.",
        "op": 7,
        "terminated": true
    }
</pre>
<p>and your client should make a new connection to the WebSocket.</p>
<h3 id="opcodes-delete-failure">8: Delete Failure</h3>
<p>This will be sent if the token is invalid when deleting the data (see <a href="#opcodes-delete-inbox">10 Delete Inbox</a> on deleting emails).</p>
<p>Example response:</p>
<pre>
    {
        "error": "Invalid token.",
        "op": 8,
        "terminated": true
    }
</pre>
<h3 id="opcodes-invalid-json">9: Invalid JSON</h3>
<p>Sent in response to a client on invalid JSON data.</p>
<p>This is strict, and any non-JSON data will result in socket termination.</p>
<p>Example data:</p>
<pre>
    {
        "error": "Invalid JSON.",
        "terminated": true,
        "op": 9
    }
</pre>
<h3 id="opcodes-delete-inbox">10: Delete Inbox (client -> server)</h3>
<p>In order to delete an existing email address, you must first be connected to the websocket and send the following data:</p>
<pre>
    {
        "op": 10,
        "token": "[your_token_here]"
    }
</pre>
<p>
    You will receive:<br>
    - <a href="#opcodes-delete-success">7 Delete Success</a> <b>on success</b>,<br>
    - <a href="#opcodes-delete-failure">8 Delete Failure</a> if the token is invalid,<br>
    - <a href="#opcodes-invalid-token">0 Invalid Token</a> if no token is specified,<br>
    - <a href="#opcodes-invalid-json">9 Invalid JSON</a> if the JSON data is invalid,<br>
    - and <a href="#opcodes-invalid-opcode">11 Invalid Opcode</a> if your opcode is invalid.<br>
    <br><br>
    Regardless of the result, the socket is terminated.
</p>
<h3 id="opcodes-invalid-opcode">11: Invalid OpCode</h3>
<p>Received if the OpCode the client sends is invalid.</p>
<p>This will terminate the connection.</p>
<pre>
    {
        "error": "No operation specified.",
        "op": 11,
        "terminated": true
    }
</pre>
<h3 id="opcodes-version">12: Version identifier</h3>
<p>The server will send its version on this OpCode to help identify potential issues with clients.</p>
<p>The client should refuse connection if it is a major version off.</p>
<p>Example:</p>
<pre>
    {
        "version": "1.2.0",
        "op": 12
    }
</pre>
<h2 id="examples">Examples</h2>
<p>In TypeScript, you can use the following with the <a href="https://npmjs.com/package/ws">ws package</a>.</p>
<pre>
    import WebSocket from "ws";
    const ws = new WebSocket("wss://gateway.exploding.email/generate");
    
    ws.on("open", () => {
        console.log(`Opened socket!`);
    });
    
    ws.on("message", (data) => {
        if(data.op === 6) {
            const json = JSON.parse(data);
            console.log(`You got an email!  From ${json.data.from}, subject: ${json.data.subject}`);
        }
    })
</pre>
</body>
</html>
